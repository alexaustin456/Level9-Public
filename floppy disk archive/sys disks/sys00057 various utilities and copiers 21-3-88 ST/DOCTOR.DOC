0660103030566
9[....................................................]
                             The Disk Doctor

                             The Disk Doctor
                   copyright 1985, 1986 Daniel Matejka

                      from Antic; the Atari Resource

         The Disk Doctor is provided on an unprotected disk because
    the author and Antic both believe that the buyer should be able to
    make backup copies for his or her use ONLY. Because it is
    unprotected, we expect you to respect the copyright and NOT give,
    sell or even lend copies of this program to anyone else. Nor
    should you accept a copy from anyone; it's the same thing as
    giving one away.

         The author spent many hours designing, developing, testing
    and writing this program. His income depends on its sales - an
    individual just like you who must work for a living. Pirate copies
    hurt him and make it less than worthwhile to continue to write
    quality products for this market if they are going to be stolen
    from him. Many other people worked to make this package what it
    is; the testers, marketing people, shippers, documentation writer:
    pirate copies make everyone's efforts less valuable and discourage
    quality efforts in the future.

         The term piracy makes it sound like copying programs
    illegally is exciting, outlaw-ish and brave. It isn't. Piracy is
    theft. It's as illegal as shoplifting or burglary in the eyes of
    the law. Please help to discourage it so that we may continue to
    provide you with unprotected software as good as this.

         No part of this publication may be reproduced, stored in a
    retrieval system or transmitted in any form or by any means
    electronic, mechanical, photocopying, recording or otherwise
    without prior written permission of the publisher. Antic and the
    author take no responsibility for any damage resulting from use or
    misuse of this program, nor do we have any liability for any
    losses, financial or otherwise incurred from the results of using
    this program. This is a powerful program and its potential for
    damage and error is significant in the hands of a novice. Make
    sure you know how to use it properly before attempting to work
    with valuable data or files.

    Antic is a trademark of Antic Publishing Inc.

    Documentation by Dan Matejka and Ian Chadwick

                           Introduction: Page 1

                             The Disk Doctor

    Overview of the Disk Doctor

         The Disk Doctor works on an Atari ST with one or two floppy
    disk drives and/or a hard disk drive. It works in monochrome or
    medium-resolution but not low-resolution. Before you use it, we
    recommend you back up the disk and all the files and store the
    original in a safe place.

         Before the Disk Doctor can do anything useful, you must open
    either a file or disk with which to work. All "opening" does is
    fix the program's attention on one file or disk in particular. To
    look at something else, first close whatever is open and then open
    that new item.

         Opening a disk allows you to access the boot sector and
    directory information, as well as the files on the disk. An ST
    disk is divided into 80 concentric circles called tracks, numbered
    from zero on the outside edge to 79 on the inside. Tracks are
    further subdivided into nine wedges called sectors. A sector - the
    smallest addressable amount of data on a disk - is 512 bytes long.
    There are 720 sectors on a disk, for a total of 360K.

         The disk is a holding place for files. Since it can hold more
    than one file, it must in addition to the files themselves contain
    a directory listing these files and where on the disk they are. A
    disk also generally contains a "boot sector," which tells the
    computer either (a) how to start up when turned on, or (b) that it
    doesn't know how to tell the computer that and please look
    elsewhere. On the Atari 520ST, the boot sector is the first sector
    on the disk (#0). The next several sectors are the directory
    mentioned earlier and the remainder of the space on the disk is
    for files.

         Space for files is allocated in clusters, explained further
    in the section on the File Allocation Table (FAT). A cluster is
    two sectors.

         When your intention is to look at a file, it is much easier
    to open the file directly because files are often not stored
    contiguously on the disk. Although files reside on disks, opening
    a disk is a different operation from opening a file.

         The Disk Doctor allows you to look directly at the data on a
    disk or in a file. You can change that data and write it back out
    to the disk. The Disk Doctor is also knowledgeable about the
    directory structure on the disk and can locate files, trace
    sectors links, patch up damaged disks or files and recover deleted
    files.

                           Introduction: Page 2

                             The Disk Doctor

         Closing does any cleaning up that needs to be done on a
    changed file and tells the Disk Doctor to unfix its attention in
    preparation for fixing it on something new. "Cleaning up" is
    something the operating system insists is done and is all
    automatic. The Disk Doctor never leaves an unclean disk around
    unless the computer is turned off, or you remove the disks without
    first closing.

         Quit stops the program and returns to the desktop. You can
    quit either through the menu or by holding the control key down
    and hitting the "Q" key. Several other commands are activated by
    control keys as shown on the menus.

         It's recommended that you read the help files through first
    before you attempt to use this program in order to get a better
    understanding of how it works and how a disk is constructed. For a
    permanent record, print them out and study them at length. When
    printing or displaying, the space bar pauses and the Return key
    stops.

                           Introduction: Page 3

                                The Disk Doctor

         The Boot Sector

              This section contains information of a more technical
         nature than most users need. It is included for information
         only.
              The first sector (#0) on an ST disk is the boot 'track'.
         It tells the ST several necessary things about the nature of
         the disk and whether or not the boot program can be loaded
         from the disk or code must be found elsewhere.

              First, an executable boot sector must 'word-checksum' to
         $1234 (4660). If the checksum is correct, the system does a
         JSR to the first byte of the buffer where the boot code was
         loaded. Since the buffer location is variable, code in the
         boot sector must be relative, not location-dependant.

              The boot sector is normally written down when a disk is
         formatted or an entire disk is copied onto another. The boot
         sector includes a 'BIOS Parameter Block' (BPB) which contains
         essential information concerning the disk and is structured
         like this:

         Byte Label  Meaning                         Values
                                                     boot/ss/ds

         $0   BRA.S  branch to boot code             60 38/00 00
         $2   ....   reserved bytes for OEM code     ....
         $8   SERIAL 24 bit serial number            ....
         $B   BPS    # of bytes per sector, LSB/MSB  00 02
         $D   SPC    # of sectors/cluster (2)        02
         $E   RES    # of reserved sectors, LSB/MSB  01 00
         $10  NFATS  # of FATs (2)                   02
         $11  NDIRS  # of directory entries, LSB/MSB 70 00
         $13  NSECTS # of sectors on media, LSB/MSB  D0 02/D0 02/A0
         05
         $15  MEDIA  description byte of media       F8/F8/F9
         $16  SPF    # of sectors/FAT, LSB/MSB       05 00
         $18  SPT    # of sectors per track, LSB/MSB 09 00
         $1A  NSIDES # of sides on media, LSB/MSB    01 00/01 00/02
         00
         $1C  NHID   # of hidden sectors, LSB/MSB    00
         $1E  ....   boot code if any                ....

              The values described here refer to typical values found
         on a TOS boot disk, a single-sided and a double sided
         non-boot disk. If only one value appears, it is the same on
         all three, if two values appear, then ss and ds are the
         same.

                              Boot sector: Page 13

                                The Disk Doctor

              TOS doesn't use the media byte although other file
         systems might. It also ignores the number of hidden sectors
         on floppies. The OEM bytes are used on a boot disk and may be
         on other company disks but are not used on a generic non-boot
         disk. The serial number is written at format time and is
         meant to be unique so that TOS can tell if a disk has been
         swapped.

         For some tools to be able to manipulate the loader, the OEM
         bytes must be $4C 6F 61 64 65 72 ('Loader' in ASCII). The
         final two bytes (one word) of the boot sector are reserved
         for the 'evening out' value which allows the checksum to be
         corrected accordingly.

              The boot loader also contains specific information as
         well as code:

         Byte  Label    Meaning
         $1E   EXECFLG  copied to _cmdload
         $20   LDMODE   load mode
         $22   SSECT    sector start
         $24   SCETCNT  # of sectors to load
         $26   LDADDR   load address
         $2A   FATBUF   FAT address
         $2E   FNAME    file name to load if LDMODE is 0
         $39   ....     reserved
         $3A   BOOTIT   boot code

              If LDMODE is zero, then the filename in FNAME is
         searched for and loaded. If non-zero, then the number of
         sectors in SECTCNT is loaded, beginning with SSECT. FATBUF
         points to the location in memory where the FAT and directory
         is placed. FNAME consists of eight characters and a three
         character extension.

              To see an example of this, read the first sector on any
         TOS boot disk. The ST boot loader can load an 'image file'
         from any disk regardless of where it appears in the directory
         or whether the sectors are stored contiguously or not. The
         image file contains no header or relocation information in
         it.

                              Boot sector: Page 14

                             The Disk Doctor

    The ST Disk Structure:

       sector 0 is the boot track
       sectors 1 through 5 are the first copy
           of the File Allocation Table (FAT)
       sectors 6 through 10 are the second FAT copy
       sectors 11 through 17 are the directory
       the remainder of the disk is data space.

         On floppies, the boot track is 1 sector long, each FAT is 5
    sectors, the directory is 7 sectors. On a single-sided disk, this
    theoretically leaves 702 sectors for data, but the operating
    system seems to count somewhat less: when a disk is formatted, it
    shows only 698 sectors available. Double-sided floppies also have
    1 sector boot tracks, On at least one hard disk, the boot track is
    again 1 sector long, each FAT is 41 sectors and the root directory
    (the main directory or desktop) is 16 sectors. Other hard disk
    structures may vary.

    DIRECTORY STRUCTURE

         The root or main directory is in the seven consecutive
    sectors mentioned above. A subdirectory (a folder or path) is
    actually a file on the disk. While the root directory is limited
    in the maximum number of files it can take, since files need not
    be contiguous, a subdirectory is not thus limited.

         Each directory entry is 32 bytes long: there are 16 entries
    per sector, laid out so:

         file name          bytes 0-7
         extension          bytes 8-10
         attributes         byte 11
         reserved space     bytes 12-21
         time stamp         bytes 22-23
         date stamp         bytes 24-25
         starting cluster   bytes 26-27 (an integer)
         length (bytes)     bytes 28-31 (a 4-byte integer)

         File name is the part of the name before the period, eight
    bytes padded on the right with blanks if less than that in length.
    If the first byte in a name is zero, the entry is unused. If $E5
    (229 decimal), then the file has been erased. If the first byte is
    a period, ($2E), then the entry is a special type of subdirectory.
    Extension is the remainder of the file name; three bytes, again
    padded with blanks. Reserved bytes are usually all zero.

                          Disk structure: Page 8


                            The Disk Doctor

         Attributes describe how the files are treated by the system.
    If the bit is zero, the attribute is off, if one it is on (used):

            bit 0 means the file is read only
            bit 1 means the file is hidden
            bit 2 means it is a system file
            bit 3 means it is a volume label, not a file
            bit 4 means it is a subdirectory
            bit 5 is an archive bit
            bits 6 and 7 are unused at present

         A read-only file cannot be written to or deleted. Hidden and
    system files are normally not seen in the directory listing but
    you can see these files by viewing the directory from the repair
    menu. The volume label is the disk name usually entered at format
    time. It normally only appears in the root directory.

         The subdirectory attribute says this is a folder (path)
    rather than a file, although they are stored in the same manner. A
    subdirectory is structured in the same manner as a root directory
    except that has no fixed size and can grow as large as necessary.

         The archive bit is set if a file has been changed since its
    last backup. Used normally only with hard disks. Attributes are
    marked on the disk information screen by a single letter. If an
    'x' appears below that letter, then the attribute is set.

         The time and date stamps record the last change of a file.

    time stamp:
            bits 0-4 are seconds/2 (0 - 29)
            bits 5-10 are minutes (0 - 59)
            bits 11-15 are hours (0 - 23)

    date stamp:
            bits 0-4 are the date (1-31)
            bits 5-8 are the month (1-12)
            bits 9-15 are the year (add 1980 to get the correct
    value)

                          Disk structure: Page 9

                             The Disk Doctor

         Starting cluster is an Intel 8088 format integer: that is,
    its bytes are swapped. That is, the low byte comes before the high
    byte. It is simply the cluster number where the file begins (there
    are two sectors in each cluster). For where the file goes after
    that, see the FAT. File Length is an Intel 8088 format longint:
    that is, its words are swapped and within each word, the bytes are
    swapped.

         File size contains the size on disk in bytes but the actual
    size in memory may be smaller if DOS reaches the last cluster in
    the FAT before this many bytes are read.


                          Disk structure: Page 10

                                The Disk Doctor

      The Display

              To examine the contents of a file or a disk, you must
         first open on from the file menu. To open a disk, specify the
         drive by its id letter in the selector window - ie A, B etc -
         then click on the OK box. The drive is opened and the first
         (#0) sector is displayed. To move to other sectors, you
         select either the 'go to' command in the sector menu or use
         the scroll bar at the right of the window (clicking on the
         arrows moves the display one sector in that direction, on the
         shaded scroll bar moves it 10 sectors). Sectors on a disk
         are, of course, always contiguous.

              To open a file, you must select the file from the GEM
         file selector window. You can move the mouse to the file and
         double click on it. If you want to change drives or folders,
         move the mouse to the drive id line and use the backspace or
         the arrow keys to correct the line. Then move the mouse to
         the shaded bar and click on it; the new directory will
         appear. Now find the file you want and double click on it.

             When a file opens, it shows the first sector of that
         file. Files are not necessarily stored in contiguous sectors
         on a disk, as explained in the sections about the directory
         and the FAT. You can move to the next sector in a file by
         clicking on the down arrow of the scroll bar or to the
         previous sector by clicking on the up arrow.

              In both disk and file displays, the screen results are
         the same. The currently displayed sector number is listed
         across the top. If it is a disk you've opened, the number is
         absolute; ie the number is the same as the sector being read
         from the disk. If it is a file, it is relative; that is: the
         sector is the first, second, etc of the total in the file but
         not necessarily the same number as that sector from which it
         was read off the disk. All number begins with zero.

              The sector is a number of so many; on a single sided
         floppy there are 720; 1440 on a double sided. The number in a
         file varies but the total will appear at the right of the
         sector number. Each value displayed represents one byte on
         the disk in that sector.

              Across the top are the numbers 0 to 29. Add this column
         to the row listed down the left side to get the position of
         the byte you want to address; a byte at column 26 and row 150
         is at location 176. There are 512 bytes in a sector and all
         are displayed on the screen at once.

                                Display: Page 4
                                The Disk Doctor

              There are two displays available: character and hex. In
         character display (the startup default), any values having
         ASCII equivalents are displayed as their characters (from
         space to ~; hex $20 to $7E). This allows you to read text,
         data, file names in the directory, etc. Non-ASCII equivalents
         retain their hexadecimal values but are greyed-out (green in
         medium resolution unless you've changed the colors with the
         control panel). In hex display, all bytes are seen as black;
         none are greyed out.

              To test the display, open one of the help files (with
         the .HLP extender) on the Disk Doctor disk and examine their
         contents. You can switch back and forth between character and
         hex displays by clicking on the selection in the sector menu
         or toggle by pressing control-V (^V). You can print the
         contents of the sector in the chosen display mode by
         selecting the print option in the sector menu.

              Other displays available will show you information in a
         more obvious format; the sector links for a file, number of
         bytes used, starting sectors and similar information. You can
         print any information by directing it to the printer when the
         query window pops up or any screen by pressing and holding
         the 'Alternate key' and pressing the 'Help' key.

              The display will be further discussed in the sections on
         editing and the various menus.

                                Display: Page 5

                                The Disk Doctor

         Editing a File or Disk

              Disk Doctor allows you to change bytes in a sector, then
         save that sector back to disk. This is very powerful and you
         can damage your files, so make sure you know what you are
         doing first. It's one thing to alter the text in a file,
         quite another to alter the code stored there.

              When you have a sector displayed (from either an open
         disk or file), use the mouse to move the cursor to any byte
         on the screen. Click the mouse button at the desired byte and
         the character will highlight (invert its color). Note that a
         hexadecimal display has two characters in each byte but an
         ASCII character is alone in a byte, since it is a
         representation of a hexadecimal character. If you toggle
         between display modes, you'll see what we mean.

         To change the character at the cursor, simply type in a new
         character from the keyboard. You can continue to enter
         characters by typing and the new characters will overwrite
         what was in the byte previously and then move to the next
         character or byte to the right. In other words, what you type
         overwrites much like a typewriter. The arrow keys will also
         move you around the screen but neither insert, delete nor
         backspace work.

              There are differences between changing character and hex
         displays. You can enter anything from the keyboard as a
         character (including the space bar) and it will overwrite the
         entire byte, even if what was there originally was a
         greyed-out hex number. If you enter a numerical value such as
         1, 2, 3 etc. in the character display, it appears on the hex
         display as its hexadecimal equivalent - 31, 32, 33 etc.

              In the hex display you can change either character in a
         byte but you can only enter a single numerical value or the
         letters A through F. This is to maintain the hex display
         format. If you don't understand hexadecimal or how it
         translates to ASCII, we recommend you read up on the topic
         before altering any bytes! Although you CAN change either
         value in a byte, you MUST enter both, even if it's only to
         enter the same value as is already shown. Disk Doctor accepts
         only the FULL byte as an entry in either mode.

                                Editing: Page 6

                                The Disk Doctor

              Understand too that simply because a hex value
         translates to a recognizeable text character that it doesn't
         mean the byte contains text. It could be part of a machine
         language code that coincidentally translates to something in
         the ASCII range. If it looks like gibberish in the text
         screen, it probably is code, not text and shouldn't be
         changed unless you know what you're doing.

              If you're doing this for the first time, here's a
         suggestion. First locate a blank (empty) sector on the disk.
         Copy the sector you want to change into the buffer then go to
         that empty sector, retrieve it and write it back to disk.
         This saves a copy of the sector in its original state so you
         can always restore it later. If you make a mistake, you can
         reverse the process and rewrite the saved sector back and
         undo any damage you may have done.

              Once you've changed a byte, you have several options.
         You can press the Undo key (or select Undo from the sector
         menu) which restores the changed bytes to their originals
         since the last read or write operation. You can save the
         displayed sector to disk, which writes the entire sector back
         to disk. Or you can close the disk or file and choose then to
         save or cancel the changes.

              Sectors can be copied from one to another, one at a
         time, by using the sector buffer. You can also print the
         contents of the sector and search for various combinations of
         numbers or characters. All this is explained in the menu help
         files.

              Disk Doctor stores information in memory about a disk.
         In order to update this information properly, always close a
         disk after you write sector zero to it and then re-open it if
         you want to continue editing it. You don't need to do this if
         you change any other sectors, only sector zero.

              A caution: some versions of TOS are case sensitive and
         don't like to deal with lowercase letters in filenames in the
         directory. Avoid using lowercase and you won't have any
         problems. Be careful when changing bytes in the directory and
         FAT; if you alter the forward pointers to the wrong clusters
         you may not be able to use those files again until you
         restore the links properly.

                                Editing: Page 7

                                The Disk Doctor

         FILE ALLOCATION TABLE STRUCTURE

              Files are allocated in clusters, not sectors. A cluster
         is just two contiguous sectors, or 1K in length. The FAT is a
         record of the clusters associated with a particular file; the
         FAT is a one-to-one correspondence with the disk after the
         first two entries; each subsequent entry refers to a cluster
         of the same location on the disk. The FAT and directory size
         is the same on single and double sided floppies.

              On floppies, each 12 bits in the FAT records a cluster
         belong to a particular file - or every 1.5 bytes. 12 bits
         means an entry can range from zero to 4096 ($FFF). On the
         hard disk, each is 16 bits, or a (byte-swapped) integer
         (which allows a range to 65535 or $FFFF).

              If an entry is zero, then the cluster is unused and
         available. If 4081 to 4087 ($FF1 to $FF7), then the cluster
         is unuseable due to a formatting error (usually a bad
         sector). If the entry contains 4088 to 4095 ($FF8 to $FFF),
         then the cluster contains the end of a file. For a hard disk,
         these values are increased by 327667 or $F0000). Any other
         value means the cluster is part of a file and the number is
         equal to the NEXT cluster belong to the file unless it's
         recorded as the last cluster.

              The first cluster is recorded in the directory. TOS
         reads that cluster into memory then goes to the FAT and reads
         the number in that entry. The number here is the NEXT cluster
         to read. This is also read and then TOS goes to the FAT entry
         corresponding to that cluster and looks for the NEXT cluster
         to read and so on until the FAT record says that this is the
         last cluster ($FF8 to $FFF) when it stops reading. each entry
         is a link to the next cluster in a file.

              The first two entries in the FAT (entries 0 and 1: three
         bytes; 1.5 bytes per entry, remember) record the disk format
         rather than refer to a particular cluster; byte one has
         either 247 ($F7) for single and double-sided floppies. The
         next two bytes are 255 ($FF). These are meant to point to the
         end of the directory but don't and are unused.

              The first cluster available on the disk is numbered two.
         This refers to sectors 18 and 19. The method of determining
         the sector is to read the entry number, subtract 2 (the first
         cluster is actually numbered 2), multiply by two (sectors per
         cluster) and add 18 (the first sector for data is 18).

                             FAT Structure: Page 11

                                The Disk Doctor

              This method allows TOS to allocate clusters around the
         disk according to availability of space. It also means that
         the smallest size of a file is 1K. To trace a file through
         its links on the FAT, the Disk Doctor has a simple command
         from the pull-down repair menu. The disk information feature
         will also give you the starting sector of a file and the
         number of bytes in length.

         The FAT and the directory are both read into memory at a
         location specified by the address at byte $2A (42) and is
         kept in memory until the disk is changed and a new directory
         read. This is why when you recover a deleted file, it doesn't
         appear in the directory; the directory in memory must first
         be update (done by closing any currently open file or disk,
         then reading a new file or disk in another drive).

                             FAT Structure: Page 12

                                The Disk Doctor

         Move Commands

              GO TO SECTOR: Moves you to the sector entered. If in
         disk mode, the sector is the same as the sector number on the
         disk. If in file mode, it is the relative sector within that
         file. You can't go to a sector outside the range given in the
         line above the sector display.

              SEARCH: Search for a string of characters in character
         display or a string of hex codes in hex display. Search
         begins at the cursor location so make sure the cursor is at
         the first byte in a sector in order to search the entire
         sector. If the byte combination isn't found, you'll be asked
         whether or not to continue searching the entire disk or file.
         Don't use spaces in the hex display but do if you want them
         found in the character display (spaces are valid
         characters).


              Search is not case sensitive; it treats '0D 0A FC' like
         '0d 0a fc' in hex display and 'this program' like 'THIS
         PROGRAM' in character display. You can't search for hex codes
         in character display and vice versa.

                             Move Commands: Page 17

                                The Disk Doctor

         Repair Menu Commands

              The repair menu has several important features,
         including the ability to display disk and file information,
         trace and locate files, repair damaged disks and files and
         recover deleted files. Most of these features are fully
         automated and require little if any input from the user. This
         makes it particularly easy for the novice to use.

              VIEW DIRECTORY: Shows you the directory on the selected
         disk. If you want to change disks, move the cursor to the
         selector line and use the backspace or arrow keys to move to
         the disk id letter and change it to the desired disk. Then
         click on the shaded bar above the file display window. To
         display a directory, click on the ok box and the direct the
         output to the screen or printer. If there is a subdirectory
         on the disk you want to display, click on it then the ok box
         and the proper output. If you click on a file name, the
         contents of that directory will be displayed, not merely the
         file itself.

              The directory display shows the file name, date and time
         of last write (access), size in bytes, start sector and
         attributes. If the filename begins with "!", then it means
         the file has been deleted. You can attempt to recover it with
         the recover file feature. As long as none of the clusters it
         used have been allocated or damaged, it should return
         intact.

              The attributes have been described in the section on
         disk structure. R means read only, H hidden, S system, V
         volume name, D subdirectory and A archive. An 'x' below the
         attribute letter means that the attribute is set (on). Notice
         that you can see a hidden file listed here; it's not visible
         in the GEM selector window!

              On subdirectories (folders), you see two unique entries:
         "." and ".."; ".." refers back to the root directory (or
         parent subdirectory if this is a folder within a folder) and
         "." refers to the subdirectory itself.

              If you intend to recover deleted files or perform other
         activities on them or hidden/system files, send the directory
         output to the printer or write down the file names of these
         particular items. These will NOT show in a GEM file selector
         window although they may be on the disk itself. You CAN
         perform activities on them by typing their names in the line
         on the window but their filenames won't be visible for mouse
         clicking.

                            Repair Commands: Page 18

                                The Disk Doctor

              If you intend to do any work at all on a file such as
         tracing, recovery or repair, it's a good idea to view that
         disk's directory first to get an idea of what sectors are in
         use and where files begin. This also serves to load the
         directory information into memory before you attempt any
         work.

              DISK INFORMATION: This presents a brief overview of the
         disk. It lists the start and length of the two FATs, the root
         directory (but not the sub directories; they're listed by the
         view directory command above) and the data area. It also
         lists the number of sectors in a cluster, the number of
         clusters used and free in the data area.

              REPAIR DISK: This is one of Disk Doctor's most powerful
         features and is almost fully automated so doesn't require and
         technical knowledge to work. Once you specify the disk drive,
         Disk Doctor asks you if you want to send the information to
         the screen or the printer. This means seeing the numbers of
         the bad sectors as they are discovered by the program.

              It then goes looking for bad sectors by trying to read
         every sector on the disk. It gathers the associated clusters
         together into a file called BOGUSAAA.BAD (the next files will
         be BOGUSAAB.BAD, BOGUSAAC.BAD and so on if you repeat this
         process for different sectors on the same disk). This is a
         hidden file and it doesn't appear in a normal directory but
         it's there on the disk anyway, locking out any bad sectors
         from use. You CAN change it to a visible file by changing the
         attribute byte in the directory (between sectors 11 and 17)
         to '00' from '06'.

              Now while the Disk Doctor is a smart program, GEM isn't.
         It sees the bad sectors and interrupts the program to tell
         you about it by sending an error message to the screen asking
         you to retry or cancel. Always click on cancel; this returns
         control back to Disk Doctor and lets it continue searching.
         Retry only keeps GEM attempting to read the bad sector.

              Note that you can't repair a disk with a bad FAT or
         directory; Disk Doctor simply can't recreate those sectors
         and has no means of tracing sectors or cluster links and
         matching them up with the correct filenames.

              Bad sectors are listed on the screen or printer. If the
         sector is part of the boot sector, file allocation table or
         disk directory, the message "Entire disk endangered" is
         displayed alongside its number. If the bad sector is part of

                            Repair Commands: Page 19

                                The Disk Doctor

         a file, the message "a file is endangered" is displayed
         instead. No attempt is made to locate which file exactly.

              TRACE FILE: Files are often scattered in various
         clusters around a disk. Trace follows these clusters and maps
         them out, listing all the sectors associated with a file. You
         can trace hidden files by typing their names into the line in
         the GEM selector window rather than clicking on them (these
         files won't show in the file window). You cannot trace
         deleted files.

              REPAIR FILE: This is different than repairing a disk; it
         tries to recover damaged files, reading every sector in the
         file rather than the disk. If any bad sectors are in fact
         found, the rest of the sectors in that cluster are salvaged,
         if possible, and the entire cluster, or whatever parts are
         readable, is picked up and put in some more tractable spot on
         the disk, and the file allocation table adjusted
         accordingly.

              It assumes the first available free cluster in the data
         area for the damaged cluster. This means you may end up with
         blank or gibberish zones in your files where the original
         sectors were unreadable. If these are text files, you may be
         able to re-write the missing material. Otherwise, you may
         have to copy good sectors from a backup into the buffer and
         then retrieve them in the newly allocated sectors to rebuild
         your damaged file.


              You still get asked if you want the process output to
         screen or the printer. Again, Disk Doctor gets interrupted by
         GEM which tells you the disk is bad and asks you to retry or
         cancel. Click on cancel to let Disk Doctor continue
         rebuilding your files.

              If you have trouble with repairing or recovering a file,
         first view the directory; this loads into memory information
         about the disk and the directory which sometimes seems to get
         misplaced. Then try again. After you repair a file, repair
         the disk to catch up the bad sectors and keep them from being
         re-used.

              RECOVER FILE: Recover File attempts to undelete files.
         First you have to type in a name in the GEM file selector
         line. The names of any deleted files are listed through the
         'view directory' feature but not in the GEM window, so you'll
         have to remember. Substitute the "!" character in the file
         name for any other and Disk Doctor will take care of the
         rest.

                            Repair Commands: Page 20

                                The Disk Doctor

              You can preview the file as it is being rebuilt or not.
         If not, Disk Doctor simply locates the first of
         however-many-that-file-needs unclaimed clusters on the disk,
         starting from the first available in the FAT, and chains them
         together in order and calls it a file. This has obvious
         ramifications for files that were deleted a long time ago, or
         built out of order on the disk. Normally if a file was
         recently deleted and nothing else was added to or deleted
         from a disk, the file remains intact in its proper clusters,
         in order, on the disk and recover works fine.

              While previewing (only), you have the option to say
         whether or not Disk Doctor should assume succeeding clusters
         always follow preceding clusters. This means; is the file to
         be recovered in contiguous clusters on the disk? If you
         answer no, then the program doesn't go back to the beginning
         when looking for the next unclaimed clusters each time. These
         get skipped. The advantage of this is that you don't go over
         the same bad sectors if present each time it looks for a free
         cluster from the start to allocate. the disadvantage is that
         those damaged sectors may have been part of the file chain
         and you break the order and lose data when the file is
         eventually recovered.

              When you preview the file, Disk Doctor displays the
         sector associated with that cluster link and asks you "Is
         this the first sector?". This is done because other data may
         have overwritten the deleted file since the deletion and the
         cluster (sector) re-allocated to another file. You have to
         decide if the first sector is actually the one you expected
         or want. Disk Doctor can't verify the data, only rebuild the
         links in the file chain.

              Each cluster in order is shown until you OK enough to
         make the file according to the file's FAT linkage. The entire
         cluster must be accepted before any of it is included in the
         file, of course. This is the origin of the "Is this the next
         sector?"/ "And this one follows?" message pairs. Pick Yes for
         both and you have an entire cluster. Pick No for either and
         none of that cluster is included. Pick Stop for either and
         whatever has been selected so far IS included, and the file
         recovering process is stopped.

              You can also specify at the beginning of the process
         that you intend to make the file longer than the directory
         says it ever was. This is intended for rebuilding
         subdirectories, which have a "length" of 0. In this case,
         file recovery stops only when the disk runs out of space, or
         you hit Stop, or an asteroid hits the computer. Never for
         anything else.

                            Repair Commands: Page 21
                                The Disk Doctor

         Obviously a file can only be partially recovered if fragments
         have been written over or damaged. Disk doctor only sees that
         the file needs so many sectors and tries to take them
         sequentially. If other file data has intruded on a cluster
         previously used by your file, then you can answer no when
         asked if the sector was the one to follow or not. A fair
         amount of judgement is needed to recover a file properly.

                            Repair Commands: Page 22

                                The Disk Doctor

         Sector Commands

              VIEW: Toggles between hex and character display.
         Character display translates any hex character in the range
         32 to 126 ($20 to $7E - from space to ~) into an ASCII
         character. In hex display mode, you can enter each nybble (4
         bits) of a byte but you must enter both (ie a full byte) for
         it to change. In character display, you enter a keyboard
         character into the entire byte. Control-V (^V) toggles
         between modes as well.

              WRITE SECTOR TO DISK: Writes currently displayed sector
         to disk at sector number described. After you write sector
         zero to disk, close the disk that's open. This updates the
         information about the disk properly. You don't need to do
         this with other sectors, only zero.

              Be especially careful about writing to the boot, FAT and
         directory sectors; you may not be able to recover from damage
         you cause to your disk easily if you make a mistake. remember
         that the undo buffer will contain the correct sector
         information if you copied it there first, before editing. You
         still may be able to recover it.

              PRINT SECTOR: Prints the current sector on the printer
         device. Make sure your printer is properly online and you
         have installed the printer properly using the desktop
         accessory. The paper automatically formfeeds after a sector
         has been printed. Other information may be printed by
         directing the output to the printer when the query window
         appears or by pressing and holding the Alternate key and
         pressing the Help key when displayed.

              The space bar pauses printing and the Return key stops
         it. This also works when displaying help files on the
         screen.

              COPY SECTOR TO BUFFER: Copies the currently displayed
         sector into the buffer. Only one sector at a time can be kept
         in the buffer. This does not alter the sector in any way and
         changes made to the sector do not affect the copy in the
         buffer. As a protection, you can copy the original contents
         into the buffer before you edit them and if you leave the
         sector and want to change it back later, you can retrieve the
         information and write it back to the sector. The copy buffer
         is, of course, wiped out when you exit the program. Control-C
         (^C) also copies the sector.

                            Sector commands: Page 15
                                The Disk Doctor

              RETRIEVE SECTOR FROM BUFFER: Recalls the sector in the
         buffer and loads it in over the information for the currently
         displayed sector. Using this command, you can transport
         sector information around the disk. To make the changes
         permanent, be sure to write the sector to disk after you have
         retrieved it. Control-R (^R) also retrieves sector
         information.

              UNDO: Undoes the changes made to the sector, even if has
         been altered and written to disk since the last change. Works
         in both display modes, even if you switch modes. However, if
         you've written a sector to disk, you can't undo it by simple
         pressing the key; you still have to write the sector back to

                            Sector commands: Page 16


